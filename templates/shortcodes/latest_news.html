<script src="https://unpkg.com/embla-carousel/embla-carousel.umd.js"></script>
<script src="https://unpkg.com/embla-carousel-autoplay/embla-carousel-autoplay.umd.js"></script>

{% set id = now() | date(format="%6f") %}

<div class="flex flex-wrap {% if color %}text-{{color}}{% endif %} {% if bg %}bg-{{bg}}{% endif %} relative" style="background-color: #FFD469;">

  {% if title %}
  <h3 class="uppercase text-sm block font-bold mb-12 w-full">{{ title }}</h3>
  {% endif %}

  <div class="text-xl leading-tight w-full pl-0 lg:pr-8 mb-10 lg:mb-0">

    {% set data = load_data(path=data_path) %}

    <div class="embla overflow-hidden" id="carousel-{{id}}">
      <div class="embla__container flex">

        {%- for news in data.news %}
        {% if news.pin and news.pin == "true" %}

        <div class="embla__slide min-w-0 flex-[0_0_100%] lg:flex-[0_0_33.333%] px-2">

          <article class="bg-white rounded-lg shadow p-6 flex flex-col h-full">

            <!-- META -->
            <p class="text-sm text-gray-600 mb-2">
              {% if news.by %}
              <span class="font-semibold">{{ news.by }}</span> •
              {% endif %}
              {{ news.date }}
            </p>

            <!-- TITLE -->
            {% if news.title %}
            <h3 class="text-[31px] font-bold mb-3 line-clamp-2">
              {{ news.title }}
            </h3>
            {% endif %}

            <!-- CLEAN TEXT -->
            {% set clean = news.anews | striptags | trim %}

            {% if clean | length > 220 %}
              <div class="text-gray-700 text-sm leading-relaxed mb-4 h-[110px] flex flex-col justify-between overflow-hidden">
                <span>{{ clean | truncate(length=220) | trim }}…</span>
                <span class="text-center text-gray-400 text-xs">• • •</span>
              </div>
            {% else %}
              <div class="text-gray-700 text-sm leading-relaxed mb-4 h-[110px] overflow-hidden">
                <span>{{ clean }}</span>
              </div>
            {% endif %}

            <!-- READ MORE -->
            <div class="mt-auto pt-3 border-t">
              <a
                class="text-blue-600 hover:underline text-sm"
                href="{{ news.originalurl | default(value='') }}"
                target="_blank">
                Read more →
              </a>
            </div>

          </article>

        </div>

        {% endif %}
        {% endfor %}

      </div>

      {% if more_news %}
      <div class="flex items-center justify-center space-x-4 w-full mt-6">

        <div class="embla__button--prev rounded-full left-arrow cursor-pointer w-12 h-12 flex items-center justify-center hover:bg-grey">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <g clip-path="url(#clip0_143_35)">
              <path d="M6.73617 3.16308L8.67303 5.09993L3.88964 9.88332L8.71504 14.7087L6.76215 16.6616L-0.000114671 9.89936L6.73617 3.16308Z" fill="#071A2D"/>
              <path d="M1.97073 11.3483L18.4191 11.2805L18.4304 8.53007L1.98207 8.5979L1.97073 11.3483Z" fill="#071A2D"/>
            </g>
            <defs>
              <clipPath id="clip0_143_35">
                <rect width="14" height="14" fill="white" transform="translate(9.89941 19.7988) rotate(-135)"/>
              </clipPath>
            </defs>
          </svg>
        </div>

        <h3 class="uppercase text-sm font-bold">
          {{ "[View all news](@/" ~ more_news ~ ")" | markdown | safe }}
        </h3>

        <div class="embla__button--next rounded-full right-arrow cursor-pointer w-12 h-12 flex items-center justify-center hover:bg-grey">
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
            <path d="M13.0627 16.6355L11.1259 14.6987L15.9093 9.91526L11.0838 5.08986L13.0367 3.13696L19.799 9.89922L13.0627 16.6355Z" fill="#071A2D"/>
            <path d="M17.8282 8.45024L1.37982 8.51807L1.36848 11.2685L17.8168 11.2007L17.8282 8.45024Z" fill="#071A2D"/>
          </svg>
        </div>

      </div>
      {% endif %}

    </div>
  </div>
</div>

<script type="text/javascript">
  const emblaNode_{{id}} = document.querySelector('#carousel-{{id}}');
  const prevBtn_{{id}} = emblaNode_{{id}}.querySelector('.embla__button--prev');
  const nextBtn_{{id}} = emblaNode_{{id}}.querySelector('.embla__button--next');
  const options_{{id}} = { loop: true, slidesToScroll: 1 };
  const plugins_{{id}} = [EmblaCarouselAutoplay({})];
  const emblaApi_{{id}} = EmblaCarousel(emblaNode_{{id}}, options_{{id}}, plugins_{{id}});

  prevBtn_{{id}}.addEventListener('click', emblaApi_{{id}}.scrollPrev, false);
  nextBtn_{{id}}.addEventListener('click', emblaApi_{{id}}.scrollNext, false);
</script>

<style>
.line-clamp-2 {
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
</style>
